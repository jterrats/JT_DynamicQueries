# Technical Debt Report

**Last Updated:** December 30, 2025
**Project:** JT Dynamic Queries
**Current Version:** v2.5.0

---

## ðŸ“Š Executive Summary

**Total Tech Debt Items:** 15+ identified issues
**Priority Breakdown:**

- ðŸ”´ **High Priority:** 3 items
- ðŸŸ¡ **Medium Priority:** 7 items
- ðŸŸ¢ **Low Priority:** 5+ items

**Estimated Effort:** ~40-60 story points
**Risk Level:** ðŸŸ¢ **Low** - Most items are non-critical improvements

---

## ðŸ”´ High Priority Tech Debt

### 1. Husky Pre-commit Hook Scanner Permissions

**Location:** `.husky/pre-commit`
**Issue:** Scanner permission errors (EPERM on `.sf/sf-2025-12-02.log`)
**Impact:** Pre-commit hooks fail, requiring `--no-verify` workaround
**Status:** Documented in CHANGELOG.md, TODO for v2.2.0

**Details:**

- Scanner cannot write logs to `~/.sf/` directory
- Workaround: Use `git commit --no-verify` (bypasses hooks)
- Risk: Code quality checks are bypassed

**Recommendation:**

- Fix SF CLI log directory permissions
- Or configure scanner to use temp directory (already attempted in `tests/e2e/utils/sfAuth.js`)
- **Effort:** 3-5 story points

**References:**

- `CHANGELOG.md:310`
- `tests/e2e/utils/sfAuth.js:30-57`

---

### 2. Deprecated Methods Still in Use

**Location:** Multiple Apex classes
**Issue:** Methods marked `@deprecated` but still referenced
**Impact:** Code maintainability, potential breaking changes

**Deprecated Methods:**

#### `JT_QueryViewerController.addWildcardsForLikeBindings()`

- **Status:** `@deprecated` - Use `JT_QueryBindingUtil.addWildcardsForLikeBindings` instead
- **Location:** `force-app/main/default/classes/JT_QueryViewerController.cls:1552`
- **Action Required:** Migrate all callers to new utility class
- **Effort:** 2-3 story points

#### `JT_UsageFinder.findConfigurationUsage()`

- **Status:** `@deprecated` - Use `findAllUsagesResilient` for fault-isolated searches
- **Location:** `force-app/main/default/classes/JT_UsageFinder.cls:126`
- **Action Required:** Update all callers to use resilient version
- **Effort:** 2-3 story points

**Recommendation:**

- Audit all callers of deprecated methods
- Create migration plan
- Remove deprecated methods in v3.0
- **Total Effort:** 4-6 story points

---

### 3. Legacy Code Handling

**Location:** Multiple classes
**Issue:** Legacy code paths for backward compatibility
**Impact:** Code complexity, potential bugs

**Legacy Patterns Found:**

#### `JT_QueryViewerController.convertBindingValueForQuery()`

- **Location:** `JT_QueryViewerController.cls:1190`
- **Issue:** Handles String values for typed fields (legacy support)
- **Comment:** "Legacy: Handle String values (shouldn't happen if JS sends typed values)"
- **Risk:** May hide type conversion bugs

#### `JT_DataSelector.convertNumericBindingValue()`

- **Location:** `JT_DataSelector.cls:475`
- **Issue:** Legacy String handling for Decimal/Integer fields
- **Comment:** "Legacy: Handle String values (shouldn't happen if JS sends typed values)"
- **Risk:** Type safety compromised

**Recommendation:**

- Add validation to ensure JS always sends typed values
- Remove legacy String handling after validation period
- **Effort:** 3-5 story points

---

## ðŸŸ¡ Medium Priority Tech Debt

### 4. Incomplete Test Coverage

**Location:** `force-app/main/default/lwc/jtSetupWizard/__tests__/jtSetupWizard.test.js`
**Issue:** Placeholder test case not implemented
**Impact:** Missing test coverage for Setup Wizard component

**Details:**

```javascript
it("TODO: test case generated by CLI command, please fill in test logic", () => {
  // Test logic missing
});
```

**Recommendation:**

- Implement comprehensive tests for Setup Wizard
- **Effort:** 2-3 story points

---

### 5. Accessibility Test Skipped

**Location:** `tests/e2e/accessibility.spec.js:77`
**Issue:** Color contrast test skipped due to SLDS component violations
**Impact:** WCAG compliance not fully validated

**Details:**

```javascript
test.skip("Color contrast should meet WCAG AA standards", async ({ page }) => {
  // TODO: Fix SLDS component contrast violations (out of our control)
});
```

**Recommendation:**

- Investigate if custom CSS can override SLDS contrast issues
- Document known violations
- **Effort:** 2-3 story points

---

### 6. Shadow DOM Detection Issues

**Location:** `tests/e2e/accessibility.spec.js` (multiple locations)
**Issue:** Shadow DOM detection failing for injected elements
**Impact:** Accessibility scanning incomplete

**Details:**

- Line 438: `// TODO: Fix Shadow DOM detection for injected elements`
- Line 471: Same TODO
- Line 605: Same TODO

**Recommendation:**

- Update Playwright/Axe accessibility scanning configuration
- Use proper Shadow DOM selectors
- **Effort:** 3-5 story points

---

### 7. Missing Skip-to-Main-Content Link

**Location:** `tests/e2e/accessibility.spec.js:247`
**Issue:** Skip-to-main-content link component not implemented
**Impact:** Keyboard navigation incomplete

**Details:**

```javascript
// TODO: Implement skip-to-main-content link component
```

**Recommendation:**

- Add skip link component for keyboard users
- **Effort:** 1-2 story points

---

### 8. Outdated Test Comments

**Location:** `tests/e2e/queryViewerPreview.spec.js:46`
**Issue:** Comment references removed UI element
**Impact:** Confusing test documentation

**Details:**

```javascript
// TODO: UI changed - "Data Preview" no longer exists, only "Query Preview"
```

**Recommendation:**

- Update test comments to reflect current UI
- **Effort:** <1 story point

---

### 9. Missing Favicon

**Location:** `docs/index-static.html:24`, `docs/_includes/head.html:27`
**Issue:** Favicon placeholder commented out
**Impact:** Missing branding in browser tabs

**Details:**

```html
<!-- Favicon (TODO: Add when ready) -->
<!-- <link rel="icon" type="image/svg+xml" href="/favicon.svg" /> -->
```

**Recommendation:**

- Create and add favicon assets
- **Effort:** 1 story point

---

### 10. Obsolete Code Comments

**Location:** `force-app/main/default/lwc/jtQueryViewer/jtQueryViewer.js:829`
**Issue:** Comment references removed code
**Impact:** Confusing code documentation

**Details:**

```javascript
// Phase 1 Refactor: Removed obsolete getters (moved to jtSearchableCombobox)
```

**Recommendation:**

- Remove obsolete comments or update to reflect current state
- **Effort:** <1 story point

---

## ðŸŸ¢ Low Priority Tech Debt

### 11. Legacy Method Signatures

**Location:** `JT_ErrorLogger.cls:225`
**Issue:** Legacy method signature maintained for backward compatibility
**Impact:** API surface area larger than necessary

**Details:**

```apex
/**
 * @description Logs an error with full context information (legacy method signature for backward compatibility)
 */
```

**Recommendation:**

- Document deprecation timeline
- Plan removal in v3.0
- **Effort:** 1 story point

---

### 12. Test Data Placeholders

**Location:** Multiple test classes
**Issue:** Placeholder IDs like `'005XX000000XXXXXXX'` used in tests
**Impact:** Tests may not catch real-world ID format issues

**Examples:**

- `JT_ToolingApiUtil_Test.cls:65`
- `JT_RunAsTestEnqueuer_Test.cls:57` (multiple)

**Recommendation:**

- Use realistic Salesforce ID formats in tests
- **Effort:** 2-3 story points

---

### 13. Temporary File Cleanup

**Location:** `tests/screenshots/captureHappyPathGifs.js:960`
**Issue:** Temporary video files cleaned up but directory structure could be improved
**Impact:** Minor - cleanup works but could be more robust

**Recommendation:**

- Improve error handling in cleanup
- **Effort:** <1 story point

---

### 14. Hardcoded Values

**Location:** Various files
**Issue:** Some magic numbers and hardcoded values
**Impact:** Configuration flexibility reduced

**Examples:**

- Retry attempts: `maxRetries = 3` (could be configurable)
- Timeout values: Various `waitForTimeout` calls

**Recommendation:**

- Extract to constants or configuration
- **Effort:** 2-3 story points

---

### 15. Documentation TODOs

**Location:** Various markdown files
**Issue:** Some documentation has placeholder content
**Impact:** Incomplete user documentation

**Examples:**

- `docs/index-static.html`: Favicon TODO
- Various roadmap items marked as "Future"

**Recommendation:**

- Review and complete documentation
- **Effort:** 2-3 story points

---

## ðŸ“‹ Planned Improvements (v3.0 Roadmap)

### Already Documented in V3_ROADMAP.md

1. **Platform Cache Implementation** (Issue #12)
   - Cache configurations, users, and query results
   - **Effort:** 5 story points

2. **Queueable Apex for Usage Search** (Issue #15)
   - Background processing for large orgs
   - **Effort:** 8 story points

3. **Security Enhancements Suite** (Issue #21)
   - CSRF protection, rate limiting, audit trail
   - **Effort:** 21 story points

4. **Metadata Export/Import** (Issue #14)
   - Export/import configurations as JSON
   - **Effort:** 13 story points

---

## ðŸŽ¯ Recommended Action Plan

### Immediate (Next Sprint)

1. âœ… **Fix Husky Pre-commit Hook** (High Priority)
   - Investigate SF CLI log directory permissions
   - Configure scanner to use temp directory
   - **Effort:** 3-5 story points

2. âœ… **Complete Setup Wizard Tests** (Medium Priority)
   - Implement missing test cases
   - **Effort:** 2-3 story points

### Short Term (Next Release - v2.6.0)

3. âœ… **Remove Deprecated Methods** (High Priority)
   - Audit and migrate all callers
   - Remove deprecated methods
   - **Effort:** 4-6 story points

4. âœ… **Fix Accessibility Issues** (Medium Priority)
   - Implement skip-to-main-content link
   - Fix Shadow DOM detection
   - **Effort:** 4-6 story points

5. âœ… **Add Favicon** (Low Priority)
   - Create favicon assets
   - **Effort:** 1 story point

### Long Term (v3.0)

6. âœ… **Remove Legacy Code Paths** (High Priority)
   - Add validation for typed values
   - Remove String handling fallbacks
   - **Effort:** 3-5 story points

7. âœ… **Improve Test Data** (Low Priority)
   - Use realistic Salesforce IDs
   - **Effort:** 2-3 story points

---

## ðŸ“Š Tech Debt Metrics

### Code Quality

- **Test Coverage:** 84.5% (Apex) âœ…
- **E2E Tests:** 28/28 passing âœ…
- **Deprecated Methods:** 2 (need migration)
- **Legacy Code Paths:** 3+ (need cleanup)

### Documentation

- **TODOs in Code:** 8+
- **Missing Documentation:** 2 items
- **Outdated Comments:** 3+

### Infrastructure

- **Pre-commit Hooks:** âš ï¸ Workaround in place
- **CI/CD:** âœ… Fully automated
- **Accessibility:** âš ï¸ 1 test skipped

---

## ðŸ” How to Identify New Tech Debt

### Code Review Checklist

- [ ] Look for `TODO`, `FIXME`, `HACK`, `XXX` comments
- [ ] Check for `@deprecated` annotations
- [ ] Review legacy code paths
- [ ] Verify test coverage for new code
- [ ] Check for hardcoded values
- [ ] Review error handling

### Regular Audits

- **Monthly:** Review TODOs and FIXMEs
- **Quarterly:** Audit deprecated methods
- **Annually:** Major refactoring review

---

## ðŸ“ Notes

- Most tech debt is **non-critical** and doesn't impact functionality
- **High priority** items are mostly infrastructure/process related
- **Code quality** is generally good (84.5% coverage, 100% E2E pass rate)
- **v3.0 roadmap** addresses many planned improvements

---

## ðŸ”— Related Documents

- [CHANGELOG.md](../CHANGELOG.md) - Technical debt section
- [V3_ROADMAP.md](./V3_ROADMAP.md) - Planned improvements
- [GITHUB_ISSUES_V3.md](./GITHUB_ISSUES_V3.md) - Feature requests and improvements

---

_This document should be updated quarterly or after major releases._
